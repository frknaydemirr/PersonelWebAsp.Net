@model MyPeronalWebSite.Models.VT.Tbl_Projects
@{
    ViewBag.Title = "Proje Düzenle";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">

<div class="container mt-4">
    <div class="card shadow border-0">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Proje Düzenle</h4>
            @Html.ActionLink("Geri Dön", "Index", null, new { @class = "btn btn-sm btn-outline-light" })
        </div>
        <div class="card-body">
            @using (Html.BeginForm("Edit", "Admin_Project", FormMethod.Post, new { enctype = "multipart/form-data", id = "projectForm" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.ID)
                @Html.ValidationSummary(true, "", new { @class = "alert alert-danger" })

                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Dil</label>
                        @Html.DropDownList("LanguageID", null, "Dil seçin...", new { @class = "form-select" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Başlık</label>
                        @Html.TextBoxFor(m => m.ProjectTitle, new { @class = "form-control", placeholder = "Proje Başlığı" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Giriş Başlığı</label>
                        @Html.TextBoxFor(m => m.ProjectEntryTitle, new { @class = "form-control", placeholder = "Proje Giriş Başlığı" })
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Github URL</label>
                        @Html.TextBoxFor(m => m.GithubURL, new { @class = "form-control", type = "url", placeholder = "https://github.com/..." })
                    </div>
                    <div class="col-12">
                        <label class="form-label fw-bold">Proje Açıklaması</label>
                        @Html.TextAreaFor(m => m.ProjectDescription, new { @class = "form-control", rows = "5", id = "editorDescription" })
                    </div>
                    <div class="col-12">
                        <label class="form-label fw-bold">Giriş Açıklaması</label>
                        @Html.TextAreaFor(m => m.ProjectEntryDescription, new { @class = "form-control", rows = "4", id = "editorEntryDescription" })
                    </div>
                    <div class="col-12">
                        <label class="form-label fw-bold">Proje Resmi</label>
                        <div class="mb-2">
                            @if (!string.IsNullOrEmpty(Model.ProjectImg))
                            {
                                <img src="@Model.ProjectImg" alt="Mevcut Resim" class="img-thumbnail mb-2" style="max-width: 250px;" id="currentImage" />
                            }
                            <img src="#" class="img-thumbnail mb-2" id="imagePreview" style="max-width: 250px; display:none;" />
                        </div>
                        <input type="file" name="ProjectImg" id="ProjectImg" class="form-control" accept="image/*" />
                        <small class="text-muted">Maksimum boyut: 5MB</small>
                    </div>
                    <div class="col-md-6 form-check form-switch mt-3">
                        @Html.CheckBox("isActive", Model.isActive ?? false, new { @class = "form-check-input", role = "switch", id = "isActiveSwitch" })
                        <label for="isActiveSwitch" class="form-check-label">Aktif</label>
                    </div>
                </div>

                <div class="mt-4 d-flex justify-content-end gap-2">
                    @Html.ActionLink("İptal", "Index", null, new { @class = "btn btn-outline-secondary" })
                    <button type="submit" class="btn btn-primary" id="submitButton">
                        <i class="fas fa-save me-1"></i> Kaydet
                    </button>
                </div>
            }
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/Areas/Admin/Content/tinymce/js/tinymce/tinymce.min.js"></script>

<script>
$(function () {
    // TinyMCE
    tinymce.init({
        selector: '#editorDescription, #editorEntryDescription',
        menubar: false,
        plugins: 'lists link image preview code fullscreen',
        toolbar: 'undo redo | bold italic | bullist numlist | link image | preview fullscreen code',
        height: 250,
        setup: function (ed) {
            ed.on('change', function () { ed.save(); });
        }
    });

    // Resim Önizleme
    $('#ProjectImg').on('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;
        if (file.size > 5 * 1024 * 1024) {
            Swal.fire('Hata', 'Resim boyutu 5MB\'dan büyük olamaz.', 'error');
            $(this).val('');
            return;
        }
        const reader = new FileReader();
        reader.onload = e => {
            $('#imagePreview').attr('src', e.target.result).show();
            $('#currentImage').hide();
        };
        reader.readAsDataURL(file);
    });

    @* Hata ve başarı mesajları *@
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <text>
        Swal.fire('Hata', '@Html.Raw(ViewBag.ErrorMessage)', 'error');
        </text>
    }
    @if (!string.IsNullOrEmpty(TempData["SuccessMessage"] as string))
    {
        <text>
        Swal.fire('Başarılı', '@TempData["SuccessMessage"]', 'success');
        </text>
    }
});
</script>
